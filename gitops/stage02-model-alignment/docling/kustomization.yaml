---
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

metadata:
  name: docling
  annotations:
    config.kubernetes.io/local-config: "true"

resources:
  - doclingserve.yaml
  # - deployment.yaml  # OLD: Manual deployment (replaced by operator)

# Docling Document Processing Service
#
# Deployment Strategy: OPERATOR-BASED (Updated 2025-11-04)
#   Using: docling-operator (https://github.com/docling-project/docling-operator)
#   CR: DoclingServe (docling.github.io/v1alpha1)
#
# Why Operator vs Direct Deployment:
#   ✅ Official docling-serve image with standard v1 API
#   ✅ Pre-built images (no runtime pip install, no missing system libs)
#   ✅ Native KFP integration for distributed conversion
#   ✅ Standard API endpoints (/v1/convert/file/async)
#   ✅ Production-ready and maintained by docling-project
#
# Architecture (Managed by Operator):
#   - DoclingServe CR → Operator creates:
#     - Deployment: docling-serve (quay.io/docling-project/docling-serve)
#     - Service: docling
#     - Route: docling (if enabled)
#     - KFP Jobs: distributed conversion via docling-jobkit
#
# Features:
#   ✅ Standard v1 REST API for document conversion
#   ✅ Async endpoint: POST /v1/convert/file/async (with polling)
#   ✅ Sync endpoint: POST /v1/convert/file/sync
#   ✅ KFP engine: distributed conversion for large documents
#   ✅ Multiple export formats (Markdown, JSON, HTML)
#
# Usage:
#   - Internal: http://docling.private-ai-demo.svc:8080
#   - External: https://docling-private-ai-demo.apps.<cluster-domain>
#
# API Endpoints (v1):
#   POST /v1/convert/file/async  - Submit conversion task (returns task_id)
#   GET  /v1/result/{task_id}    - Poll for completion
#   POST /v1/convert/file/sync   - Synchronous conversion
#
# Integration with KFP Pipelines:
#   Pipeline component uses /v1/convert/file/async with polling
#   See: stages/stage2-model-alignment/kfp/pipeline.py
#
# Operator Installation:
#   1. CRD: oc apply -f config/crd/bases/
#   2. Operator: oc apply -k config/default
#   3. CR: oc apply -f doclingserve.yaml
#
# Reference:
#   - Operator: https://github.com/docling-project/docling-operator
#   - Docling: https://github.com/docling-project/docling
#   - RHOAI 2.25: https://docs.redhat.com/en/documentation/red_hat_openshift_ai_self-managed/2.25/html-single/working_with_llama_stack/index
