apiVersion: v1
data:
  notebook.ipynb: "{\n \"cells\": [\n  {\n   \"cell_type\": \"markdown\",\n   \"metadata\":
    {},\n   \"source\": [\n    \"# ACME LithoOps Copilot - RAG Demo\\n\",\n    \"\\n\",\n
    \   \"Production-ready RAG system for ACME lithography operations.\\n\",\n    \"\\n\",\n
    \   \"**Use Case**: Technical support for L-900 EUV tools and PX-7 product.\"\n
    \  ]\n  },\n  {\n   \"cell_type\": \"code\",\n   \"execution_count\": null,\n
    \  \"id\": \"1eedc8f7\",\n   \"metadata\": {},\n   \"outputs\": [],\n   \"source\":
    [\n    \"# Install required packages\\n\",\n    \"!pip install -q llama-stack-client
    openai fire\\n\"\n   ]\n  },\n  {\n   \"cell_type\": \"markdown\",\n   \"metadata\":
    {},\n   \"source\": [\n    \"## Overview\\n\",\n    \"\\n\",\n    \"This notebook
    demonstrates the ACME LithoOps Copilot using:\\n\",\n    \"- **Llama Stack** for
    RAG orchestration\\n\",\n    \"- **Milvus** for vector storage (IBM Granite 768-d
    embeddings)\\n\",\n    \"- **Mistral-24B-Quantized** for answer synthesis\\n\",\n
    \   \"- **6 ACME documents** (SOPs, SPCs, FMEAs, Playbooks, Recipes, Reports)\\n\",\n
    \   \"\\n\",\n    \"**Comparison**: Baseline (no RAG) vs RAG (with document retrieval)\"\n
    \  ]\n  },\n  {\n   \"cell_type\": \"code\",\n   \"execution_count\": null,\n
    \  \"id\": \"ec3dec19\",\n   \"metadata\": {},\n   \"outputs\": [],\n   \"source\":
    [\n    \"# Setup\\n\",\n    \"from llama_stack_client import LlamaStackClient,
    Agent, AgentEventLogger\\n\",\n    \"from openai import OpenAI\\n\",\n    \"import
    uuid\\n\",\n    \"\\n\",\n    \"# Configuration\\n\",\n    \"LLAMASTACK_URL =
    \\\"http://llamastack.private-ai-demo.svc:8321\\\"\\n\",\n    \"VLLM_URL
    = \\\"http://mistral-24b-quantized-predictor.private-ai-demo.svc.cluster.local/v1\\\"\\n\",\n
    \   \"MODEL_ID = \\\"mistral-24b-quantized\\\"\\n\",\n    \"\\n\",\n    \"# Initialize
    clients\\n\",\n    \"stack_client = LlamaStackClient(base_url=LLAMASTACK_URL)\\n\",\n
    \   \"vllm_client = OpenAI(base_url=VLLM_URL, api_key=\\\"dummy\\\")\\n\",\n    \"\\n\",\n
    \   \"print(\\\"✅ Imports complete\\\")\\n\",\n    \"print(f\\\"\U0001F4E1 Llama
    Stack: {LLAMASTACK_URL}\\\")\\n\",\n    \"print(f\\\"\U0001F916 vLLM: {VLLM_URL}\\\")\\n\",\n
    \   \"print(f\\\"\U0001F916 Model: {MODEL_ID}\\\")\"\n   ]\n  },\n  {\n   \"cell_type\":
    \"code\",\n   \"execution_count\": null,\n   \"metadata\": {},\n   \"outputs\":
    [],\n   \"source\": [\n    \"# ACME Test Questions\\n\",\n    \"QUESTIONS = {\\n\",\n
    \   \"    \\\"limits\\\": \\\"What are the dose UCL and overlay UCL limits for
    PX-7 product on M1 layer?\\\",\\n\",\n    \"    \\\"limit_check\\\": \\\"Is a
    measured overlay of 3.8 nm within specification for PX-7 M1 layer?\\\",\\n\",\n
    \   \"    \\\"calibration\\\": \\\"What is the DFO calibration procedure for the
    L-900 EUV tool?\\\",\\n\",\n    \"    \\\"troubleshooting\\\": \\\"The L-900 tool
    is showing overlay drift >4 nm. What troubleshooting steps should I follow?\\\"\\n\",\n
    \   \"}\\n\",\n    \"\\n\",\n    \"# Use limit_check for main demo\\n\",\n    \"DEMO_QUESTION
    = QUESTIONS[\\\"limit_check\\\"]\\n\",\n    \"\\n\",\n    \"print(\\\"\U0001F4CB
    ACME Test Questions:\\\")\\n\",\n    \"for key, question in QUESTIONS.items():\\n\",\n
    \   \"    print(f\\\"\\\\n{key.upper()}:\\\")\\n\",\n    \"    print(f\\\"  {question}\\\")\"\n
    \  ]\n  },\n  {\n   \"cell_type\": \"markdown\",\n   \"metadata\": {},\n   \"source\":
    [\n    \"## Scenario 1: Baseline (No RAG)\\n\",\n    \"\\n\",\n    \"First, let's
    ask the model **without RAG**. The model will respond based only on its training
    data (generic lithography knowledge).\"\n   ]\n  },\n  {\n   \"cell_type\": \"code\",\n
    \  \"execution_count\": null,\n   \"metadata\": {},\n   \"outputs\": [],\n   \"source\":
    [\n    \"print(\\\"=\\\"*70)\\n\",\n    \"print(\\\"BASELINE RESPONSE (No RAG
    - Direct vLLM)\\\")\\n\",\n    \"print(\\\"=\\\"*70)\\n\",\n    \"print()\\n\",\n
    \   \"print(f\\\"Question: {DEMO_QUESTION}\\\")\\n\",\n    \"print()\\n\",\n    \"\\n\",\n
    \   \"try:\\n\",\n    \"    response = vllm_client.chat.completions.create(\\n\",\n
    \   \"        model=MODEL_ID,\\n\",\n    \"        messages=[{\\\"role\\\": \\\"user\\\",
    \\\"content\\\": DEMO_QUESTION}],\\n\",\n    \"        max_tokens=500\\n\",\n
    \   \"    )\\n\",\n    \"    \\n\",\n    \"    baseline_answer = response.choices[0].message.content\\n\",\n
    \   \"    print(baseline_answer)\\n\",\n    \"        \\n\",\n    \"except Exception
    as e:\\n\",\n    \"    print(f\\\"❌ Error: {e}\\\")\\n\",\n    \"    baseline_answer
    = \\\"Error\\\"\\n\",\n    \"\\n\",\n    \"print()\\n\",\n    \"print(\\\"=\\\"*70)\"\n
    \  ]\n  },\n  {\n   \"cell_type\": \"markdown\",\n   \"metadata\": {},\n   \"source\":
    [\n    \"## Scenario 2: RAG (With Document Retrieval)\\n\",\n    \"\\n\",\n    \"Now
    let's use **RAG with Llama Stack Agent**. The system will:\\n\",\n    \"1. Retrieve
    relevant chunks from ACME documents\\n\",\n    \"2. Use those chunks to generate
    a grounded answer\\n\",\n    \"3. Include precise citations [Doc, §section, p.X]\"\n
    \  ]\n  },\n  {\n   \"cell_type\": \"code\",\n   \"execution_count\": null,\n
    \  \"metadata\": {},\n   \"outputs\": [],\n   \"source\": [\n    \"print(\\\"=\\\"*70)\\n\",\n
    \   \"print(\\\"RAG RESPONSE (With ACME Documents - Llama Stack Agent)\\\")\\n\",\n
    \   \"print(\\\"=\\\"*70)\\n\",\n    \"print()\\n\",\n    \"print(f\\\"Question:
    {DEMO_QUESTION}\\\")\\n\",\n    \"print()\\n\",\n    \"\\n\",\n    \"try:\\n\",\n
    \   \"    # Initialize Llama Stack client\\n\",\n    \"    llama_client = LlamaStackClient(base_url=LLAMASTACK_URL)\\n\",\n
    \   \"    \\n\",\n    \"    # Create RAG agent with ACME-specific instructions\\n\",\n
    \   \"    rag_agent = Agent(\\n\",\n    \"        llama_client,\\n\",\n    \"
    \       model=MODEL_ID,\\n\",\n    \"        instructions=(\\n\",\n    \"            \\\"You
    are an ACME LithoOps technical assistant. \\\"\\n\",\n    \"            \\\"Answer
    questions using ONLY information from the retrieved ACME documents. \\\"\\n\",\n
    \   \"            \\\"\\\\n\\\"\\n\",\n    \"            \\\"For limit queries:\\\\n\\\"\\n\",\n
    \   \"            \\\"- Provide the specific numeric limit with units\\\\n\\\"\\n\",\n
    \   \"            \\\"- Compare measured value against limit\\\\n\\\"\\n\",\n
    \   \"            \\\"- State clearly: IN SPEC or OUT OF SPEC\\\\n\\\"\\n\",\n
    \   \"            \\\"- Include troubleshooting actions if out of spec\\\\n\\\"\\n\",\n
    \   \"            \\\"\\\\n\\\"\\n\",\n    \"            \\\"For troubleshooting
    queries:\\\\n\\\"\\n\",\n    \"            \\\"- Start with immediate diagnostic
    actions\\\\n\\\"\\n\",\n    \"            \\\"- List steps as bullets\\\\n\\\"\\n\",\n
    \   \"            \\\"- Provide escalation path\\\\n\\\"\\n\",\n    \"            \\\"\\\\n\\\"\\n\",\n
    \   \"            \\\"For procedural queries:\\\\n\\\"\\n\",\n    \"            \\\"-
    Summarize the procedure\\\\n\\\"\\n\",\n    \"            \\\"- List key steps\\\\n\\\"\\n\",\n
    \   \"            \\\"- Note prerequisites\\\\n\\\"\\n\",\n    \"            \\\"\\\\n\\\"\\n\",\n
    \   \"            \\\"Citations: Include [Doc, §section, p.X] for every claim.
    \\\"\\n\",\n    \"            \\\"If information is not in ACME sources, say 'Not
    found in ACME sources.'\\\"\\n\",\n    \"        ),\\n\",\n    \"        tools=[\\n\",\n
    \   \"            {\\n\",\n    \"                \\\"name\\\": \\\"builtin::rag/knowledge_search\\\",\\n\",\n
    \   \"                \\\"args\\\": {\\\"vector_db_ids\\\": [\\\"rag_documents\\\"]},\\n\",\n
    \   \"            }\\n\",\n    \"        ],\\n\",\n    \"    )\\n\",\n    \"    \\n\",\n
    \   \"    print(\\\"✅ Agent created\\\")\\n\",\n    \"    print()\\n\",\n    \"
    \   \\n\",\n    \"    # Create session\\n\",\n    \"    session_id = rag_agent.create_session(session_name=f\\\"acme-demo-{uuid.uuid4().hex[:8]}\\\")\\n\",\n
    \   \"    print(f\\\"✅ Session created: {session_id}\\\")\\n\",\n    \"    print()\\n\",\n
    \   \"    \\n\",\n    \"    # Query with RAG\\n\",\n    \"    response = rag_agent.create_turn(\\n\",\n
    \   \"        messages=[{\\\"role\\\": \\\"user\\\", \\\"content\\\": DEMO_QUESTION}],\\n\",\n
    \   \"        session_id=session_id,\\n\",\n    \"        stream=True,\\n\",\n
    \   \"    )\\n\",\n    \"    \\n\",\n    \"    # Capture and log response\\n\",\n
    \   \"    rag_answer = \\\"\\\"\\n\",\n    \"    for log in AgentEventLogger().log(response):\\n\",\n
    \   \"        log.print()\\n\",\n    \"        if hasattr(log, 'content') and
    log.content:\\n\",\n    \"            rag_answer += log.content\\n\",\n    \"
    \   \\n\",\n    \"    print()\\n\",\n    \"    \\n\",\n    \"except Exception
    as e:\\n\",\n    \"    print(f\\\"❌ Error: {e}\\\")\\n\",\n    \"    print(\\\"\\\\nℹ️
    \ Note: RAG requires ACME documents to be ingested into Milvus.\\\")\\n\",\n    \"
    \   print(\\\"   Run the Tekton pipeline first: pipeline-acme-ingestion\\\")\\n\",\n
    \   \"    rag_answer = None\\n\",\n    \"\\n\",\n    \"print(\\\"=\\\"*70)\"\n
    \  ]\n  },\n  {\n   \"cell_type\": \"markdown\",\n   \"metadata\": {},\n   \"source\":
    [\n    \"## Side-by-Side Comparison\\n\",\n    \"\\n\",\n    \"Let's compare the
    two approaches:\"\n   ]\n  },\n  {\n   \"cell_type\": \"code\",\n   \"execution_count\":
    null,\n   \"metadata\": {},\n   \"outputs\": [],\n   \"source\": [\n    \"if rag_answer:\\n\",\n
    \   \"    # Format for side-by-side display\\n\",\n    \"    def format_column(text,
    width=70):\\n\",\n    \"        lines = []\\n\",\n    \"        for line in text.split('\\\\n'):\\n\",\n
    \   \"            if len(line) <= width:\\n\",\n    \"                lines.append(line.ljust(width))\\n\",\n
    \   \"            else:\\n\",\n    \"                words = line.split()\\n\",\n
    \   \"                current_line = \\\"\\\"\\n\",\n    \"                for
    word in words:\\n\",\n    \"                    if len(current_line) + len(word)
    + 1 <= width:\\n\",\n    \"                        current_line += (\\\" \\\"
    if current_line else \\\"\\\") + word\\n\",\n    \"                    else:\\n\",\n
    \   \"                        lines.append(current_line.ljust(width))\\n\",\n
    \   \"                        current_line = word\\n\",\n    \"                if
    current_line:\\n\",\n    \"                    lines.append(current_line.ljust(width))\\n\",\n
    \   \"        return lines\\n\",\n    \"    \\n\",\n    \"    baseline_lines =
    format_column(baseline_answer)\\n\",\n    \"    rag_lines = format_column(rag_answer)\\n\",\n
    \   \"    \\n\",\n    \"    # Pad to same length\\n\",\n    \"    max_len = max(len(baseline_lines),
    len(rag_lines))\\n\",\n    \"    baseline_lines += [\\\"\\\".ljust(70)] * (max_len
    - len(baseline_lines))\\n\",\n    \"    rag_lines += [\\\"\\\".ljust(70)] * (max_len
    - len(rag_lines))\\n\",\n    \"    \\n\",\n    \"    print(\\\"=\\\"*140)\\n\",\n
    \   \"    print(f\\\"{'BASELINE (No RAG)'.center(70)} | {'RAG (With ACME Documents)'.center(70)}\\\")\\n\",\n
    \   \"    print(\\\"=\\\"*140)\\n\",\n    \"    \\n\",\n    \"    for baseline,
    rag in zip(baseline_lines, rag_lines):\\n\",\n    \"        print(f\\\"{baseline}
    | {rag}\\\")\\n\",\n    \"    \\n\",\n    \"    print(\\\"=\\\"*140)\\n\",\n    \"else:\\n\",\n
    \   \"    print(\\\"⚠️  RAG answer not available - ACME documents may need to
    be ingested\\\")\"\n   ]\n  },\n  {\n   \"cell_type\": \"markdown\",\n   \"metadata\":
    {},\n   \"source\": [\n    \"## Test All ACME Questions\\n\",\n    \"\\n\",\n
    \   \"Let's test all question types to see RAG's performance:\"\n   ]\n  },\n
    \ {\n   \"cell_type\": \"code\",\n   \"execution_count\": null,\n   \"metadata\":
    {},\n   \"outputs\": [],\n   \"source\": [\n    \"def test_question_with_rag(question,
    question_type):\\n\",\n    \"    \\\"\\\"\\\"Test a question with RAG\\\"\\\"\\\"\\n\",\n
    \   \"    print(f\\\"\\\\n{'='*70}\\\")\\n\",\n    \"    print(f\\\"TEST: {question_type.upper()}\\\")\\n\",\n
    \   \"    print(f\\\"{'='*70}\\\")\\n\",\n    \"    print(f\\\"\\\\nQuestion:
    {question}\\\")\\n\",\n    \"    print()\\n\",\n    \"    \\n\",\n    \"    try:\\n\",\n
    \   \"        # Create new session\\n\",\n    \"        new_session_id = rag_agent.create_session(session_name=f\\\"test-{question_type}-{uuid.uuid4().hex[:8]}\\\")\\n\",\n
    \   \"        \\n\",\n    \"        # Query\\n\",\n    \"        response = rag_agent.create_turn(\\n\",\n
    \   \"            messages=[{\\\"role\\\": \\\"user\\\", \\\"content\\\": question}],\\n\",\n
    \   \"            session_id=new_session_id,\\n\",\n    \"            stream=True,\\n\",\n
    \   \"        )\\n\",\n    \"        \\n\",\n    \"        # Capture response\\n\",\n
    \   \"        answer = \\\"\\\"\\n\",\n    \"        for log in AgentEventLogger().log(response):\\n\",\n
    \   \"            log.print()\\n\",\n    \"            if hasattr(log, 'content')
    and log.content:\\n\",\n    \"                answer += log.content\\n\",\n    \"
    \       \\n\",\n    \"        print()\\n\",\n    \"        return answer\\n\",\n
    \   \"        \\n\",\n    \"    except Exception as e:\\n\",\n    \"        print(f\\\"❌
    Error: {e}\\\")\\n\",\n    \"        return None\\n\",\n    \"\\n\",\n    \"#
    Test all questions if agent is available\\n\",\n    \"if rag_answer and 'rag_agent'
    in locals():\\n\",\n    \"    results = {}\\n\",\n    \"    for q_type, question
    in QUESTIONS.items():\\n\",\n    \"        if q_type != \\\"limit_check\\\":  #
    Already tested\\n\",\n    \"            results[q_type] = test_question_with_rag(question,
    q_type)\\n\",\n    \"    \\n\",\n    \"    print(\\\"\\\\n✅ All questions tested!\\\")\\n\",\n
    \   \"else:\\n\",\n    \"    print(\\\"⚠️  Skipping additional tests - agent not
    available\\\")\"\n   ]\n  },\n  {\n   \"cell_type\": \"markdown\",\n   \"metadata\":
    {},\n   \"source\": [\n    \"## Summary\\n\",\n    \"\\n\",\n    \"The ACME LithoOps
    Copilot demonstrates:\\n\",\n    \"\\n\",\n    \"✅ **Accurate Limit Checking**:
    Compares measured values against specs with numeric precision\\n\",\n    \"\\n\",\n
    \   \"✅ **Grounded Troubleshooting**: Provides action-oriented steps from official
    playbooks\\n\",\n    \"\\n\",\n    \"✅ **Precise Citations**: Every claim is backed
    by [Doc, §section, p.X] references\\n\",\n    \"\\n\",\n    \"✅ **Manufacturing
    Context**: Understands tools (L-900), products (PX-7), and layers (M1)\\n\",\n
    \   \"\\n\",\n    \"✅ **Multi-Document Synthesis**: Integrates SOPs, SPCs, FMEAs,
    and Playbooks\\n\",\n    \"\\n\",\n    \"**Next Steps**: Run evaluation harness
    to test all 10 questions systematically.\"\n   ]\n  }\n ],\n \"metadata\": {\n
    \ \"kernelspec\": {\n   \"display_name\": \"Python 3\",\n   \"language\": \"python\",\n
    \  \"name\": \"python3\"\n  },\n  \"language_info\": {\n   \"name\": \"python\",\n
    \  \"version\": \"3.11.0\"\n  }\n },\n \"nbformat\": 4,\n \"nbformat_minor\":
    5\n}\n"
kind: ConfigMap
metadata:
  creationTimestamp: null
  name: notebook-04-acme
