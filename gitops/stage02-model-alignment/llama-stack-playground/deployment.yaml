---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: llama-stack-playground
  namespace: private-ai-demo
  labels:
    app: llama-stack-playground
    app.kubernetes.io/name: llama-stack-playground
    app.kubernetes.io/component: ui
    app.kubernetes.io/part-of: private-ai-demo
spec:
  replicas: 1
  selector:
    matchLabels:
      app: llama-stack-playground
  template:
    metadata:
      labels:
        app: llama-stack-playground
        app.kubernetes.io/name: llama-stack-playground
        app.kubernetes.io/component: rag-ui
        app.kubernetes.io/part-of: private-ai-demo
        app.openshift.io/runtime: python
      annotations:
        sidecar.istio.io/inject: "false"
        app.openshift.io/connects-to: '[{"apiVersion":"v1","kind":"Service","name":"llamastack"}]'
        app.openshift.io/vcs-uri: "https://github.com/adnan-drina/private-ai-demo"
        app.openshift.io/vcs-ref: "feature/stage2-implementation"
    spec:
      containers:
        - name: playground
          image: quay.io/rh-aiservices-bu/llama-stack-playground:latest
          imagePullPolicy: IfNotPresent
          env:
            # Server-side Python client environment variables
            - name: LLAMA_STACK_BASE_URL
              value: "http://llama-stack-service.private-ai-demo.svc:8321"
            - name: LLAMA_STACK_URL
              value: "http://llama-stack-service.private-ai-demo.svc:8321"
            - name: LLAMA_STACK_ENDPOINT
              value: "http://llama-stack-service.private-ai-demo.svc:8321"
            # Browser-side calls use external HTTPS Route
            - name: NEXT_PUBLIC_LLAMA_STACK_URL
              value: "https://llamastack-private-ai-demo.apps.cluster-gmgrr.gmgrr.sandbox5294.opentlc.com"
            # Default vector DB for RAG queries
            - name: RAG_DEFAULT_VECTOR_DB_ID
              value: "acme_corporate"
          ports:
            - name: http
              containerPort: 8501
          resources:
            requests:
              cpu: 50m
              memory: 128Mi
            limits:
              cpu: 200m
              memory: 256Mi
          livenessProbe:
            httpGet:
              path: /
              port: http
            initialDelaySeconds: 30
            periodSeconds: 10
          readinessProbe:
            httpGet:
              path: /
              port: http
            initialDelaySeconds: 10
            periodSeconds: 5

---
apiVersion: v1
kind: Service
metadata:
  name: llama-stack-playground
  namespace: private-ai-demo
  labels:
    app: llama-stack-playground
    app.kubernetes.io/name: llama-stack-playground
spec:
  selector:
    app: llama-stack-playground
  ports:
    - name: http
      port: 8501
      targetPort: http

---
apiVersion: route.openshift.io/v1
kind: Route
metadata:
  name: llama-stack-playground
  namespace: private-ai-demo
  labels:
    app: llama-stack-playground
    app.kubernetes.io/name: llama-stack-playground
spec:
  to:
    kind: Service
    name: llama-stack-playground
  port:
    targetPort: http
  tls:
    termination: edge
    insecureEdgeTerminationPolicy: Redirect

