apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

metadata:
  name: llama-stack
  annotations:
    config.kubernetes.io/local-config: "true"

# NOTE: LlamaStack Operator Activation
# The operator must be activated via DataScienceCluster patch.
# This is handled by the deploy script using:
#   oc patch datasciencecluster default-dsc --type merge \
#     --patch '{"spec":{"components":{"llamastack":{"managementState":"Managed"}}}}'
# 
# See: datasciencecluster-patch.yaml for reference
# This is a ONE-TIME cluster-level operation, not a component deployment.

generatorOptions:
  disableNameSuffixHash: true

configMapGenerator:
  - name: llama-stack-playground-chat
    namespace: private-ai-demo
    files:
      - chat.py=playground-chat.py
  - name: llama-stack-playground-rag
    namespace: private-ai-demo
    files:
      - rag.py=playground-rag.py

resources:
  - serviceaccount.yaml  # RBAC for Llama Stack pods
  - configmap.yaml
  - pvc.yaml
  - configmap-sitecustomize.yaml
  - llamastack-distribution.yaml
  - service.yaml
  - route.yaml
  - servicemonitor.yaml  # Prometheus metrics collection
  - playground-deployment.yaml  # Streamlit UI for LlamaStack (no default vector_db)
patches:
  - target:
      kind: Deployment
      name: llama-stack
    path: patch-llama-stack-recreate.yaml

