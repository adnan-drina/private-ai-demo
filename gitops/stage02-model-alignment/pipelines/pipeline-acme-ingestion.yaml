apiVersion: tekton.dev/v1beta1
kind: Pipeline
metadata:
  name: acme-document-ingestion
  namespace: private-ai-demo
  labels:
    app: docling-pipeline
    scenario: acme
spec:
  description: Complete ACME document ingestion pipeline (Docling → Metadata → Chunk → Milvus)
  params:
    - name: document-list
      type: array
      description: List of ACME PDF filenames to process
      default:
        - "ACME_01_ACME_DFO_Calibration_SOP_v1.9_(Tool_L-900_EUV).pdf"
        - "ACME_02_PX-7_Lithography_Control_Plan_&_SPC_Limits.pdf"
        - "ACME_03_L-900_Tool_Health_&_Predictive_Rules_(FMEA_Extract).pdf"
        - "ACME_04_Scanner_&_Metrology_Test_Recipe_Handbook.pdf"
        - "ACME_05_Trouble_Response_Playbook_(Tier-1-Tier-2).pdf"
        - "ACME_06_Reliability_Summary_Q3_FY25.pdf"
  workspaces:
    - name: documents
      description: PVC for document storage
  tasks:
    # Process ACME documents with dedicated task
    - name: process-acme-documents
      taskRef:
        name: docling-process-acme
      workspaces:
        - name: documents
          workspace: documents
    
    # Extract ACME metadata for each document
    - name: extract-metadata-acme-01
      runAfter: ["process-acme-documents"]
      taskRef:
        name: extract-acme-metadata
      params:
        - name: doc-name
          value: "ACME_01_ACME_DFO_Calibration_SOP_v1.9_(Tool_L-900_EUV).pdf"
      workspaces:
        - name: documents
          workspace: documents
    
    - name: extract-metadata-acme-02
      runAfter: ["process-acme-documents"]
      taskRef:
        name: extract-acme-metadata
      params:
        - name: doc-name
          value: "ACME_02_PX-7_Lithography_Control_Plan_&_SPC_Limits.pdf"
      workspaces:
        - name: documents
          workspace: documents
    
    - name: extract-metadata-acme-03
      runAfter: ["process-acme-documents"]
      taskRef:
        name: extract-acme-metadata
      params:
        - name: doc-name
          value: "ACME_03_L-900_Tool_Health_&_Predictive_Rules_(FMEA_Extract).pdf"
      workspaces:
        - name: documents
          workspace: documents
    
    - name: extract-metadata-acme-04
      runAfter: ["process-acme-documents"]
      taskRef:
        name: extract-acme-metadata
      params:
        - name: doc-name
          value: "ACME_04_Scanner_&_Metrology_Test_Recipe_Handbook.pdf"
      workspaces:
        - name: documents
          workspace: documents
    
    - name: extract-metadata-acme-05
      runAfter: ["process-acme-documents"]
      taskRef:
        name: extract-acme-metadata
      params:
        - name: doc-name
          value: "ACME_05_Trouble_Response_Playbook_(Tier-1-Tier-2).pdf"
      workspaces:
        - name: documents
          workspace: documents
    
    - name: extract-metadata-acme-06
      runAfter: ["process-acme-documents"]
      taskRef:
        name: extract-acme-metadata
      params:
        - name: doc-name
          value: "ACME_06_Reliability_Summary_Q3_FY25.pdf"
      workspaces:
        - name: documents
          workspace: documents
    
    # Chunk documents
    - name: chunk-acme-01
      runAfter: ["extract-metadata-acme-01"]
      taskRef:
        name: chunk-acme-documents
      params:
        - name: doc-name
          value: "ACME_01_ACME_DFO_Calibration_SOP_v1.9_(Tool_L-900_EUV).pdf"
      workspaces:
        - name: documents
          workspace: documents
    
    - name: chunk-acme-02
      runAfter: ["extract-metadata-acme-02"]
      taskRef:
        name: chunk-acme-documents
      params:
        - name: doc-name
          value: "ACME_02_PX-7_Lithography_Control_Plan_&_SPC_Limits.pdf"
      workspaces:
        - name: documents
          workspace: documents
    
    - name: chunk-acme-03
      runAfter: ["extract-metadata-acme-03"]
      taskRef:
        name: chunk-acme-documents
      params:
        - name: doc-name
          value: "ACME_03_L-900_Tool_Health_&_Predictive_Rules_(FMEA_Extract).pdf"
      workspaces:
        - name: documents
          workspace: documents
    
    - name: chunk-acme-04
      runAfter: ["extract-metadata-acme-04"]
      taskRef:
        name: chunk-acme-documents
      params:
        - name: doc-name
          value: "ACME_04_Scanner_&_Metrology_Test_Recipe_Handbook.pdf"
      workspaces:
        - name: documents
          workspace: documents
    
    - name: chunk-acme-05
      runAfter: ["extract-metadata-acme-05"]
      taskRef:
        name: chunk-acme-documents
      params:
        - name: doc-name
          value: "ACME_05_Trouble_Response_Playbook_(Tier-1-Tier-2).pdf"
      workspaces:
        - name: documents
          workspace: documents
    
    - name: chunk-acme-06
      runAfter: ["extract-metadata-acme-06"]
      taskRef:
        name: chunk-acme-documents
      params:
        - name: doc-name
          value: "ACME_06_Reliability_Summary_Q3_FY25.pdf"
      workspaces:
        - name: documents
          workspace: documents
    
    # Ingest to Milvus
    - name: ingest-acme-01
      runAfter: ["chunk-acme-01"]
      taskRef:
        name: ingest-acme-to-milvus
      params:
        - name: doc-name
          value: "ACME_01_ACME_DFO_Calibration_SOP_v1.9_(Tool_L-900_EUV).pdf"
      workspaces:
        - name: documents
          workspace: documents
    
    - name: ingest-acme-02
      runAfter: ["chunk-acme-02"]
      taskRef:
        name: ingest-acme-to-milvus
      params:
        - name: doc-name
          value: "ACME_02_PX-7_Lithography_Control_Plan_&_SPC_Limits.pdf"
      workspaces:
        - name: documents
          workspace: documents
    
    - name: ingest-acme-03
      runAfter: ["chunk-acme-03"]
      taskRef:
        name: ingest-acme-to-milvus
      params:
        - name: doc-name
          value: "ACME_03_L-900_Tool_Health_&_Predictive_Rules_(FMEA_Extract).pdf"
      workspaces:
        - name: documents
          workspace: documents
    
    - name: ingest-acme-04
      runAfter: ["chunk-acme-04"]
      taskRef:
        name: ingest-acme-to-milvus
      params:
        - name: doc-name
          value: "ACME_04_Scanner_&_Metrology_Test_Recipe_Handbook.pdf"
      workspaces:
        - name: documents
          workspace: documents
    
    - name: ingest-acme-05
      runAfter: ["chunk-acme-05"]
      taskRef:
        name: ingest-acme-to-milvus
      params:
        - name: doc-name
          value: "ACME_05_Trouble_Response_Playbook_(Tier-1-Tier-2).pdf"
      workspaces:
        - name: documents
          workspace: documents
    
    - name: ingest-acme-06
      runAfter: ["chunk-acme-06"]
      taskRef:
        name: ingest-acme-to-milvus
      params:
        - name: doc-name
          value: "ACME_06_Reliability_Summary_Q3_FY25.pdf"
      workspaces:
        - name: documents
          workspace: documents

