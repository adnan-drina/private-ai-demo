apiVersion: tekton.dev/v1
kind: PipelineRun
metadata:
  generateName: mistral-24b-quantized-v2-
  namespace: private-ai-demo
  labels:
    tekton.dev/pipeline: modelcar-build-deploy-v2
    app.kubernetes.io/name: modelcar-pipeline
    app.kubernetes.io/component: mlops-pipeline
    app.kubernetes.io/part-of: private-ai-demo
    model: mistral-24b-quantized
    pipeline-version: v2
  annotations:
    argocd.argoproj.io/hook: Skip
    description: "Quantized Mistral 24B model - NEW pipeline v2 with parallel pushes"
spec:
  pipelineRef:
    name: modelcar-build-deploy-v2
  
  params:
    # Model source - Quantized Mistral 24B
    - name: hf_repo
      value: "RedHatAI/Mistral-Small-24B-Instruct-2501-quantized.w4a16"
    - name: hf_revision
      value: "main"
    
    # Image configuration
    - name: image_stream_name
      value: "mistral-24b-quantized"
    - name: image_tag
      value: "w4a16-2501"
    
    # Quay configuration
    - name: quay_org
      value: "adrina"
    - name: quay_repo
      value: "private-ai"
    - name: quay_tag
      value: "mistral-24b-quantized-w4a16-2501"
    
    # Model Registry
    - name: model_name
      value: "Mistral-Small-24B-Instruct"
    - name: version_name
      value: "quantized-w4a16-2501-v2"
    - name: version_description
      value: "Mistral Small 24B Instruct quantized (w4a16), packaged as ModelCar using v2 pipeline. Optimized for single GPU."
    - name: base_model
      value: "mistralai/Mistral-Small-24B-Instruct-2501"
    - name: quantization
      value: "w4a16"
    - name: gpu_requirement
      value: "1"
  
  workspaces:
    # Shared workspace for download, build, and push operations
    - name: shared-workspace
      volumeClaimTemplate:
        spec:
          accessModes:
            - ReadWriteOnce
          resources:
            requests:
              storage: 200Gi  # Quantized model (~25GB) + build artifacts + OCI layers
    
    # Internal registry authentication (ServiceAccount has permissions)
    - name: registry-auth
      emptyDir: {}
    
    # Quay.io authentication
    - name: quay-auth
      secret:
        secretName: quay-credentials
  
  timeouts:
    pipeline: "1h30m"
    tasks: "1h"

