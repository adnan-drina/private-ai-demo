apiVersion: nfd.openshift.io/v1
kind: NodeFeatureDiscovery
metadata:
  name: nfd-instance
  namespace: openshift-machine-api
  labels:
    app.kubernetes.io/instance: stage00-gpu-infrastructure
    app.kubernetes.io/part-of: stage00-ai-platform
spec:
  instance: ""
  operand:
    # Let operator use its default image (with valid digest)
    imagePullPolicy: Always
  enableTaints: false
  prunerOnDelete: false
  topologyUpdater: false
  workerConfig:
    tolerations:
      - key: nvidia.com/gpu
        operator: Exists
        effect: NoSchedule
    configData: |
      core:
        sleepInterval: 60s
      sources:
        pci:
          deviceClassWhitelist:
            - "0200"
            - "03"
            - "12"
          deviceLabelFields:
            - "vendor"
            # Removed "device" to emit vendor-level labels (pci-10de.present)
            # This is required for GPU Operator to recognize NVIDIA nodes
        usb:
          deviceClassWhitelist:
            - "0e"
            - "ef"
            - "fe"
            - "ff"
          deviceLabelFields:
            - "serial"
            - "vendor"
            - "device"

