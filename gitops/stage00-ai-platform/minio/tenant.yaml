apiVersion: minio.min.io/v2
kind: Tenant
metadata:
  name: model-storage
  namespace: model-storage
  labels:
    app.kubernetes.io/part-of: stage00-ai-platform
    app.kubernetes.io/component: object-storage
    app.kubernetes.io/instance: minio-tenant
  annotations:
    argocd.argoproj.io/sync-wave: "1"
    openshift.io/display-name: "MinIO Tenant for Model Storage"
    prometheus.io/path: /minio/v2/metrics/cluster
    prometheus.io/port: "9000"
    prometheus.io/scrape: "true"
spec:
  # Image configuration
  image: quay.io/minio/minio:RELEASE.2024-10-13T13-34-11Z
  imagePullPolicy: IfNotPresent
  
  # Service account
  serviceAccountName: minio-sa
  
  # Single-zone deployment (sufficient for model storage)
  # Scale this for production HA
  pools:
  - servers: 1
    name: pool-0
    volumesPerServer: 1
    volumeClaimTemplate:
      metadata:
        name: data
        labels:
          app.kubernetes.io/part-of: stage00-ai-platform
      spec:
        accessModes:
          - ReadWriteOnce
        storageClassName: gp3-csi  # AWS gp3 SSD - fast for model downloads
        resources:
          requests:
            storage: 500Gi  # Large enough for multiple full-precision models
    
    # Resource allocation for MinIO pods
    resources:
      requests:
        cpu: "2"
        memory: "4Gi"
      limits:
        cpu: "4"
        memory: "8Gi"
    
    # Security context
    securityContext:
      runAsUser: 1000
      runAsGroup: 1000
      fsGroup: 1000
      runAsNonRoot: true
  
  # Credentials secret (will be auto-generated by operator)
  # Reference this in model-serving pods
  credsSecret:
    name: minio-credentials
  
  # Expose MinIO API and Console
  exposeServices:
    console: true
    minio: true
  
  # Certificate management (auto-generate)
  requestAutoCert: true
  
  # S3 API configuration
  s3:
    bucketDNS: false
  
  # Features
  features:
    bucketDNS: false
    domains: {}
  
  # Liveness probe
  liveness:
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 5
  
  # Readiness probe  
  readiness:
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 5
  
  # Prometheus metrics
  prometheusOperator: false
  
  # Logging
  logging:
    json: true
    quiet: false
  
  # Environment variables for performance tuning
  env:
    - name: MINIO_BROWSER
      value: "on"
    - name: MINIO_PROMETHEUS_AUTH_TYPE
      value: "public"
    - name: MINIO_UPDATE
      value: "off"  # Disable auto-updates in production

