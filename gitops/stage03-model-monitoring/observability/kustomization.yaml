apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

metadata:
  name: observability
  annotations:
    config.kubernetes.io/local-config: "true"

# Observability Component - Red Hat Pattern
# Complete observability stack following Red Hat's lls-observability architecture
# Reference: https://github.com/rh-ai-quickstart/lls-observability
#
# Architecture:
#   Applications → OTLP → OTEL Collector → Prometheus endpoint + Tempo → Grafana
#
# Components (phase ordering):
#   1. Operators: OpenTelemetry, Tempo, Grafana
#   2. Infrastructure: OTEL Collector, Tempo Stack, Grafana instance, datasources, dashboards
#   3. Metrics/Tracing integrations: PodMonitors, Pushgateway
#
# Prerequisites:
#   - OpenShift User Workload Monitoring enabled (Stage 0)
#   - Operators installed before infrastructure (deploy.sh)

resources:
  # Observability infrastructure
  - tempo-storage-secret.yaml
  - tempo-stack.yaml
  - otel-collector.yaml
  - servicemonitor-otel-collector.yaml
  - grafana-instance.yaml
  - network-policy-grafana-operator.yaml
  - grafana-datasource.yaml
  - grafana-datasource-tempo.yaml
  - grafana-dashboard-enhanced.yaml
  - grafana-dashboard-ai-metrics.yaml
  - grafana-dashboard-eval-results.yaml
  - grafana-dashboard-traces.yaml
  - grafana-dashboard-guidellm.yaml
  - podmonitor.yaml
  - podmonitor-dcgm.yaml
  - pushgateway.yaml
  - otel-targetallocator-rbac.yaml

# Operators are applied first (deploy.sh orchestrates sequencing).
# Kustomize applies the infrastructure + dashboards in a single pass for reproducibility.

